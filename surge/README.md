# Coastal risk assessment using ROMS

This directory contains scripts and executables for running the Regional Ocean Model System (ROMS) to assess coastal risk due to tropical cyclone storm surges. For a specified location, 2000 years of synthetically (statistically) generated tropical cyclones are used to force the ROMS ocean surface. Tracks from the STORM dataset (Bloemendaal et al., 2020) are expanded into 2D wind and pressure fields using the parametric model of Holland, (1980). Wind fields are then converted to wind stress at the ocean surface using a quadratic function of windspeed and a drag coefficient according to (Peng et al., 2020). The ParaTC python package is used to generate forcing.

A validation against observed storm surges at tide gauges shows a mean absolute error in maximum surge of ~17cm and a correlation of 84%. For more information on the methodology and accuracy assessment, see (methodologydoc).

## Setup

1. Use env_surge.yml and conda/mamba to create a new Python environment with the necessary dependencies:
``` conda create -n roms_env -f env_surge.yml ```
2. Install the modules for `crisk_surge`:
``` pip install -e . ```
The `-e` flag means that the modules are editable. The functions are found in `src/crisk_surge`.
3. To generate ROMs grids, the PyROMS library is used, which requires a separate installation. It is best to clone the PyROMS repository and install it using `pip`. See here for instructions. Sometimes PyROMS will have trouble finding <library> on the system. In this case, go into `pyroms/pyroms/src/...` and change line X to reflect its path on your system. This is probably somewhere like `usr/lib`.

## How to use

This is a project based framework, i.e. we create a new 'project' directory for each area of study and model domain. Each project directory is stored and controlled from the `/projects/` directory in this repository. Before running the model, each project directory should contain:

1. `roms_grd.nc` : The ROMS grid file. This is generated using the `make_grid.py` script in `projects/`. This script uses PyROMS (and by extension `GridGen`) to generate a rectangular ROMS grid file from the command line. 
2. `roms.in.template` : The ROMS control input file. This is a template file, meaning there are missing lines waiting to be filled by our python scripts.
3. `romsM`: Files starting with `romsM` are the ROMS executables.
4. `maxima/`: This is the directory where the storm surge maxima for each year of simulation will be stored.
5. `plots/`: If you are doing validation, initial plots will be stored here.

Other files required to run ROMS in this framework are:

1. `roms_frc.nc`: The model forcing file, which contains wind stress vectors and atmospheric pressure.
2. `roms_tide.nc`: A tidal forcing file, containing tidal harmonic information.

These files will be generated by some of the Python scripts in this repository. You can use the `make_project.sh` script in `projects/` to quickly generate a new project directory, automatically copying over the required files. For example: `make_project.sh new_project_name`. This should be run from `projects/` and inside your new directory there will be `roms.in.template`, `romsM`, `maxima/` and `plots/`.

**Command Line Scripts**
An overview is provided below. However, to get more detailed information on inputs you can use the `-h` flag, e.g. `python make_grid.py -h`.

1. `make_grid.py`: Generates from the `projects/` directory, providing it with the `-proj` argument (project name / directory). You also provide it with the top left (`-c1`) and top right (`-c2`) corners of the grid you want to generate, and then the length in degrees (`-cdist`). You can specify the approximate resolution in km using the `-res` argument. For example:

```
python 
```
